@{
    ViewData["Title"] = "Mouses";
}
@model List<DTOS.MiceDTOs.MiceDto> // List bo'lishi kerak tekshirish uchun qoldirildi


@await Html.PartialAsync("_navmenu")
<section>
    <div class="container theme-showcase main-container" role="main">
        <div class="row">
            <div class="col-lg-15 col-md-15 col-sm-20 col-xs-60">
                <div id="column-left">
                    <div class="col-filter">
                        <form href="?" id="catalog-filter-form">
                            <div class="col-filter-div-header header-filter">
                                <a class="header-filterr" id="collapseExamplee" role="button">Фильтр</a>
                            </div>
                            <div class="" id="">
                                <div class="filter-hidden">
                                    <div class="col-filter-div">
                                        <div class="header-sub-filter" style="padding: 0">Бренды</div>
                                        <div class="checkbox checkbox-success">
                                            <input class="styled brands-checkbox"
                                                   id="brands-checkbox-0" type="checkbox"
                                                   value="brand-2e-gaming">
                                            <label for="brands-checkbox-0">2E Gaming</label>
                                        </div>
                                        <div class="checkbox checkbox-success">
                                            <input class="styled brands-checkbox"
                                                   id="brands-checkbox-1" type="checkbox"
                                                   value="brand-cooler-master">
                                            <label for="brands-checkbox-1">Cooler Master</label>
                                        </div>
                                        <div class="checkbox checkbox-success">
                                            <input class="styled brands-checkbox"
                                                   id="brands-checkbox-2" type="checkbox"
                                                   value="brand-corsair">
                                            <label for="brands-checkbox-2">Corsair</label>
                                        </div>
                                        <div class="checkbox checkbox-success">
                                            <input class="styled brands-checkbox"
                                                   id="brands-checkbox-3" type="checkbox"
                                                   value="dark-project">
                                            <label for="brands-checkbox-3">Dark Project</label>
                                        </div>
                                        <div class="checkbox checkbox-success">
                                            <input class="styled brands-checkbox"
                                                   id="brands-checkbox-4" type="checkbox"
                                                   value="brand-dream-machines">
                                            <label for="brands-checkbox-4">Dream Machines</label>
                                        </div>
                                        <div class="checkbox checkbox-success">
                                            <input class="styled brands-checkbox"
                                                   id="brands-checkbox-5" type="checkbox"
                                                   value="brand-ducky">
                                            <label for="brands-checkbox-5">Ducky</label>
                                        </div>
                                        <div class="checkbox checkbox-success">
                                            <input class="styled brands-checkbox"
                                                   id="brands-checkbox-6" type="checkbox"
                                                   value="brand-hyperx">
                                            <label for="brands-checkbox-6">HyperX</label>
                                        </div>
                                        <div class="checkbox checkbox-success">
                                            <input class="styled brands-checkbox"
                                                   id="brands-checkbox-7" type="checkbox"
                                                   value="brand-keychron">
                                            <label for="brands-checkbox-7">Keychron</label>
                                        </div>
                                        <div class="checkbox checkbox-success">
                                            <input class="styled brands-checkbox"
                                                   id="brands-checkbox-8" type="checkbox"
                                                   value="brand-logitech">
                                            <label for="brands-checkbox-8">Logitech</label>
                                        </div>
                                        <div class="checkbox checkbox-success">
                                            <input class="styled brands-checkbox"
                                                   id="brands-checkbox-9" type="checkbox"
                                                   value="brand-rapoo">
                                            <label for="brands-checkbox-9">Rapoo</label>
                                        </div>
                                        <div class="checkbox checkbox-success">
                                            <input class="styled brands-checkbox"
                                                   id="brands-checkbox-10" type="checkbox"
                                                   value="brand-razer">
                                            <label for="brands-checkbox-10">Razer</label>
                                        </div>
                                        <div class="checkbox checkbox-success">
                                            <input class="styled brands-checkbox"
                                                   id="brands-checkbox-11" type="checkbox"
                                                   value="brand-redragon">
                                            <label for="brands-checkbox-11">Redragon</label>
                                        </div>
                                        <div class="checkbox checkbox-success">
                                            <input class="styled brands-checkbox"
                                                   id="brands-checkbox-12" type="checkbox"
                                                   value="brand-steelseries">
                                            <label for="brands-checkbox-12">SteelSeries</label>
                                        </div>
                                        <div class="checkbox checkbox-success">
                                            <input class="styled brands-checkbox"
                                                   id="brands-checkbox-13" type="checkbox"
                                                   value="tuf-gaming">
                                            <label for="brands-checkbox-13">TUF Gaming</label>
                                        </div>
                                        <div class="checkbox checkbox-success">
                                            <input class="styled brands-checkbox"
                                                   id="brands-checkbox-14" type="checkbox"
                                                   value="brand-xtrfy">
                                            <label for="brands-checkbox-14">Xtrfy</label>
                                        </div>
                                        <input type="hidden" name="brands" id="brands-hidden-input">
                                    </div>

                                    <div id="slider-non-linear-step" style="
    width: 80%;
    margin-left: 30px;
"></div>
                                    <div id="slider-non-linear-step-value"></div>

                                    <input type="hidden" id="min" name="price-min" />
                                    <input type="hidden" id="max" name="price-max" />
                                    <script>
                                        var slider = document.getElementById('slider-non-linear-step');

                                        noUiSlider.create(slider, {
                                            start: [parseInt('128000') - 100000,
                                            parseInt('2550000') + 100000],
                                            connect: true,
                                            range: {
                                                'min': parseInt('128000') - 1,
                                                'max': parseInt('2550000') + 100000
                                            }
                                        });
                                        var nonLinearStepSliderValueElement = document.getElementById('slider-non-linear-step-value');

                                        slider.noUiSlider.on('update', function (values) {
                                            // console.log(values);
                                            values[0] = number_format(Math.round(values[0]), 0, '.', ' ')
                                            values[1] = number_format(Math.round(values[1]), 0, '.', ' ')
                                            // console.log(values)''

                                            nonLinearStepSliderValueElement.innerHTML = values.join(' - ');
                                            let u = nonLinearStepSliderValueElement.innerHTML;
                                            u = u.split('-');
                                            $('#min').val(u[0].replace(/\s/g, ''))
                                            $('#max').val(u[1].replace(/\s/g, ''))
                                        });
                                        function number_format(number, decimals, dec_point, thousands_point) {

                                            if (number == null || !isFinite(number)) {
                                                throw new TypeError("number is not valid");
                                            }

                                            if (!decimals) {
                                                var len = number.toString().split('.').length;
                                                decimals = len > 1 ? len : 0;
                                            }

                                            if (!dec_point) {
                                                dec_point = '.';
                                            }

                                            if (!thousands_point) {
                                                thousands_point = ',';
                                            }

                                            number = parseFloat(number).toFixed(decimals);

                                            number = number.replace(".", dec_point);

                                            var splitNum = number.split(dec_point);
                                            splitNum[0] = splitNum[0].replace(/\B(?=(\d{3})+(?!\d))/g, thousands_point);
                                            number = splitNum.join(dec_point);

                                            return number;
                                        }
                                    </script>

                                    <div id="catalog-characteristics">
                                        <div class="header-sub-filter">Частота опроса</div>
                                        <div class="col-filter-div">
                                            <select class="characteristics-0"
                                                    id="characteristics-0">
                                                <option value="">Выберите из списка</option>
                                                <option value="1000 Гц">1000 Гц</option>
                                                <option value="2000 Гц">2000 Гц</option>
                                                <option value="8000 Гц">8000 Гц</option>
                                            </select>
                                        </div>
                                        <input type="hidden"
                                               name="characteristics[5]"
                                               id="characteristics-0-hidden-input">
                                        <div class="header-sub-filter">Количество кнопок</div>
                                        <div class="col-filter-div">
                                            <select class="characteristics-1"
                                                    id="characteristics-1">
                                                <option value="">Выберите из списка</option>
                                                <option value="17">17</option>
                                                <option value="18">18</option>
                                                <option value="3">3</option>
                                                <option value="5">5</option>
                                                <option value="6">6</option>
                                                <option value="7">7</option>
                                                <option value="8">8</option>
                                                <option value="9">9</option>
                                            </select>
                                        </div>
                                        <input type="hidden"
                                               name="characteristics[7]"
                                               id="characteristics-1-hidden-input">
                                        <div class="header-sub-filter">Максимальное разрешение DPI/CPI</div>
                                        <div class="col-filter-div">
                                            <select class="characteristics-2"
                                                    id="characteristics-2">
                                                <option value="">Выберите из списка</option>
                                                <option value="1000">1000</option>
                                                <option value="10000">10000</option>
                                                <option value="12000">12000</option>
                                                <option value="12400">12400</option>
                                                <option value="16000">16000</option>
                                                <option value="18000">18000</option>
                                                <option value="19000">19000</option>
                                                <option value="20000">20000</option>
                                                <option value="25600">25600</option>
                                                <option value="26000">26000</option>
                                                <option value="32000">32000</option>
                                                <option value="5000">5000</option>
                                                <option value="6200">6200</option>
                                                <option value="6400">6400</option>
                                                <option value="8000">8000</option>
                                                <option value="8500">8500</option>
                                            </select>
                                        </div>
                                        <input type="hidden"
                                               name="characteristics[4]"
                                               id="characteristics-2-hidden-input">
                                        <div class="header-sub-filter">Акселерация (максимальное ускорение)</div>
                                        <div class="col-filter-div">
                                            <select class="characteristics-3"
                                                    id="characteristics-3">
                                                <option value="">Выберите из списка</option>
                                                <option value="15 G">15 G</option>
                                                <option value="20 G">20 G</option>
                                                <option value="22,5 G">22,5 G</option>
                                                <option value="30 G">30 G</option>
                                                <option value="35 G">35 G</option>
                                                <option value="40G">40G</option>
                                                <option value="40 G">40 G</option>
                                                <option value="50G">50G</option>
                                                <option value="50 G">50 G</option>
                                            </select>
                                        </div>
                                        <input type="hidden"
                                               name="characteristics[6]"
                                               id="characteristics-3-hidden-input">
                                        <div class="header-sub-filter">Тип сенсора</div>
                                        <div class="col-filter-div">
                                            <select class="characteristics-4"
                                                    id="characteristics-4">
                                                <option value="">Выберите из списка</option>
                                                <option value="Оптический">Оптический</option>
                                                <option value="Оптический Focus+">Оптический Focus+</option>
                                                <option value="Оптический HERO 2">Оптический HERO 2</option>
                                                <option value="Оптический HERO 25K">Оптический HERO 25K</option>
                                                <option value="Оптический  HyperX 26K">Оптический  HyperX 26K</option>
                                                <option value="Оптический HyperX 26K">Оптический HyperX 26K</option>
                                                <option value="Оптический PixArt 3311">Оптический PixArt 3311</option>
                                                <option value="Оптический PixArt 3325">Оптический PixArt 3325</option>
                                                <option value="Оптический PixArt 3327">Оптический PixArt 3327</option>
                                                <option value="Оптический PixArt 3360">Оптический PixArt 3360</option>
                                                <option value="Оптический PixArt 3370">Оптический PixArt 3370</option>
                                                <option value="Оптический PixArt PAW 3327">Оптический PixArt PAW 3327</option>
                                                <option value="Оптический PixArt PAW 3335">Оптический PixArt PAW 3335</option>
                                                <option value="Оптический PixArt PMW 3327">Оптический PixArt PMW 3327</option>
                                                <option value="Оптический PixArt PMW 3360">Оптический PixArt PMW 3360</option>
                                                <option value="Оптический PixArt PMW 3370">Оптический PixArt PMW 3370</option>
                                                <option value="Оптический PixArt PMW 3389">Оптический PixArt PMW 3389</option>
                                                <option value="Оптический PixArt PMW 3391">Оптический PixArt PMW 3391</option>
                                                <option value="Оптический Sunplus 199 IC">Оптический Sunplus 199 IC</option>
                                                <option value="Оптический TrueMove Air">Оптический TrueMove Air</option>
                                                <option value="Оптический TrueMove Core">Оптический TrueMove Core</option>
                                                <option value="Оптический TrueMove Pro">Оптический TrueMove Pro</option>
                                                <option value="Оптический TrueMove Pro+">Оптический TrueMove Pro+</option>
                                            </select>
                                        </div>
                                        <input type="hidden"
                                               name="characteristics[3]"
                                               id="characteristics-4-hidden-input">
                                        <div class="header-sub-filter">Режим работы</div>
                                        <div class="col-filter-div">
                                            <select class="characteristics-5"
                                                    id="characteristics-5">
                                                <option value="">Выберите из списка</option>
                                                <option value="2.4 ГГц">2.4 ГГц</option>
                                                <option value="2.4 ГГц, Bluetooth">2.4 ГГц, Bluetooth</option>
                                                <option value="2.4 ГГц, Bluetooth 5.0">2.4 ГГц, Bluetooth 5.0</option>
                                                <option value="2.4 ГГц, Bluetooth 5.0, Проводной">2.4 ГГц, Bluetooth 5.0, Проводной</option>
                                                <option value="2.4 ГГц, Bluetooth, Проводной">2.4 ГГц, Bluetooth, Проводной</option>
                                                <option value="2.4 ГГц, Провод">2.4 ГГц, Провод</option>
                                                <option value="2.4 ГГц, Проводной">2.4 ГГц, Проводной</option>
                                                <option value="Проводной">Проводной</option>
                                            </select>
                                        </div>
                                        <input type="hidden"
                                               name="characteristics[167]"
                                               id="characteristics-5-hidden-input">
                                    </div>
                                </div>
                            </div>
                            <input type="hidden" id="order">
                            <input type="hidden" id="counting">
                            <button id="filter-clear" class="btn btn-default btn-filter">Сбросить фильтр</button>
                            <input type="submit" value="Применить фильтр" id="catalog-filter-submit" class="btn btn-default btn-filter" />
                        </form>
                    </div>
                    
                </div>
            </div>
            <div class="col-lg-45 col-md-45 col-sm-40 col-xs-60 col-content" id="content">
                <div class="row">
                    <div class="col-lg-60 col-breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
                        <ol class="breadcrumb mt-1">
                            <li class="breadcrumb-item"><a href="/">Home</a></li>
                            <li class="breadcrumb-item active">Мышки</li>
                        </ol>
                    </div>
                    <div class="col-lg-60 col-xs-60">
                        <h1 class="nomargin">Мышки</h1>
                    </div>
                    <div class="col-lg-60 col-xs-60">
                        <img class="img-responsive" src="https://upg.uz/storage/files/categories/1/thumbs/88VGAOxxSqHRheJA8Yc5u8a9udwQ3bfM4bAD297K.png" alt="Манипуляторы и аксессуары" />
                    </div>
                    <div class="col-lg-60 col-xs-60">
                        <div class="col-center-filter">
                            <div class="row">
                                <form id="category-order-form">
                                    <div class="col-lg-25 col-md-23 col-sm-60 col-xs-60 col-center-filter-item">
                                        <label for="order">Сортировка</label>
                                        <select onchange="categoryFormSubmit()" data-width="auto" name="order"
                                                id="category-order">
                                            <option value="" selected>
                                                По
                                                умолчанию
                                            </option>
                                            <option value="ASC">
                                                Наименование (А -&gt; Я)
                                            </option>
                                            <option value="DESC">
                                                Наименование (Я -&gt; А)
                                            </option>
                                            <option value="ASC_price">
                                                Цена (по возрастанию)
                                            </option>
                                            <option value="DESC_price">
                                                Цена (по убыванию)
                                            </option>
                                            <option value="DESC_rating">
                                                Рейтинг (по убыванию)
                                            </option>
                                            <option value="ASC_rating">
                                                Рейтинг (по возрастанию)
                                            </option>
                                        </select>
                                    </div>
                                    <div class="col-lg-18 col-md-18 col-sm-60 col-xs-60 col-center-filter-item">
                                        <div class="category-products-count-filter">
                                            <label>Товаров на странице</label>
                                            <select onchange="categoryFormSubmit()" name="counting"
                                                    data-width="auto" id="category-counting">
                                                <option value="20">
                                                    20
                                                </option>
                                                <option value="30">
                                                    30
                                                </option>
                                                <option value="40" selected>
                                                    40
                                                </option>
                                                <option value="50">
                                                    50
                                                </option>
                                                <option value="60">
                                                    60
                                                </option>
                                            </select>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <div class="row-viewed col-catalog-grid product-grid">
                            @foreach (var i in Model)
                            {
                                <div class="col-lg-12 col-md-15 col-sm-20 col-xs-30 item-product">
                                    <div class="item-product-inner">
                                        <a asp-action="Sborka" asp-controller="Product" asp-route-id="@i.Id" class="item-link">

                                            <img class="item-product-img center-block"
                                                 src="@($"https://localhost:7010/{i.ImageUrls.FirstOrDefault()}")"
                                                 alt="@($"https://localhost:7010/{i.ImageUrls.FirstOrDefault()}")">

                                            @i.Name

                                        </a>
                                        <div class="product-mini-rating">
                                            <div class="mp-small_rate" mp-prod_id="">
                                                <div class="mp-rating-value-wrap">
                                                    <div class="mp-rating-value">
                                                        <div style="width:100%"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <span class="item-price price-old">@i.Price сум</span>

                                        <span class="item-price price-new">@i.Price сум</span>

                                        <div class="item-buttons center-block">
                                            <a class="item-buy-btn cart" role="button" onclick="addToCart('1');"
                                               id="cartActive1" data-id="c1" data-productname="@i.Name"
                                               data-productslug="hyperx-pulsefire-haste">Купить</a>
                                            <a class="item-compare-btn libra" role="button"
                                               onclick="addToCompare(1, 1, '@i.Name.ToLower();', '@i.Name')"
                                               data-id="l1"></a>
                                        </div>
                                    </div>
                                    <script>
                                        localStorage.getItem('compare_product').split(',').forEach(el => {
                                            if (el === "1") {
                                                $(`[data-id="l${el}"]`).addClass('selected_libra');
                                            }
                                        })
                                        if (JSON.parse(localStorage.getItem('product_id')) != null) {
                                            JSON.parse(localStorage.getItem('product_id')).forEach(el => {
                                                if (el.product_id === "1") {
                                                    $(`[data-id="c${el.product_id}"]`).addClass('selected_cart');
                                                }
                                            })
                                        }

                                    </script>
                                </div>
                                <script>
                                    function showModal(productId, productSlug, productName) {
                                        $(`[data-id="l${productId}"]`).addClass('active');
                                        const elements = localStorage.getItem('compare_product');
                                        const categoryElements = JSON.parse(elements);
                                        const elementKeys = Object.keys(categoryElements);
                                        const parameter = `?categories=${elementKeys}&data=${categoryElements[elementKeys[0]]}`;
                                        $('#modalNew').show();
                                        $('#informModalCartCompare').html(`<div>Товар <a href="/products/${productId}">${productName}</a> добавлен в <a id="compareBtn" href="https://upg.uz/en/compare${parameter}#">список сравнения товаров</a>!</div>`);
                                    }

                                    function getProductLength() {
                                        let elements = localStorage.getItem('compare_product');
                                        let categoryElements = JSON.parse(elements);
                                        let compareProducts = 0;
                                        if (elements) {
                                            const elementKeys = Object.keys(categoryElements);
                                            for (const elementKey in elementKeys) {
                                                const element = categoryElements[elementKeys[elementKey]].split(',');
                                                element[element.length - 1] === '' ? element.splice(-1, 1) : element;
                                                compareProducts += element.length;
                                            }
                                        }

                                        return compareProducts;
                                    }

                                    function addToCompare(productId, categoryId, productSlug, productName) {
                                        const compareProducts = localStorage.getItem('compare_product');
                                        if (compareProducts) {
                                            let compare_products = '';
                                            let exist = false;
                                            let cart_product_check = [];
                                            let productIds = JSON.parse(localStorage.getItem('compare_product'));

                                            if (productIds[categoryId]) {
                                                console.log('category exists');
                                                console.log(productIds[categoryId]);
                                                cart_product_check = productIds[categoryId].split(',');

                                                for (let i = 0; i <= cart_product_check.length; i++) {
                                                    if (parseInt(cart_product_check[i]) === productId) {
                                                        console.log('exists')
                                                        exist = true;
                                                    }
                                                }
                                            }

                                            if (!exist) {
                                                console.log('workng not exist')
                                                if (cart_product_check.length < 1) {
                                                    productIds[categoryId] = `${productId},`;
                                                    localStorage.setItem('compare_product', JSON.stringify(productIds));
                                                    let containerCounter = $('#top-compare-total');
                                                    containerCounter.text(getProductLength());
                                                    showModal(productId, productSlug, productName);
                                                    $(`#l${productId}`).addClass('active');

                                                } else if (cart_product_check.length <= 3 && cart_product_check.length >= 1) {
                                                    $.ajax({
                                                        url: '/check-compare/' + productId + '/' + cart_product_check[0],
                                                        method: 'GET',
                                                        success: function (data) {
                                                            if (data.message === 'success') {
                                                                compare_products = productIds[categoryId];
                                                                compare_products += `${productId},`;
                                                                productIds[categoryId] = compare_products;
                                                                localStorage.setItem('compare_product', JSON.stringify(productIds));
                                                                let containerCounter = $('#top-compare-total');
                                                                containerCounter.text(getProductLength());
                                                                showModal(productId, productSlug, productName);
                                                            } else {
                                                                alert('For comparing products categories must be the same')
                                                                $(`[data-id="l${productId}"]`).removeClass('selected_libra')
                                                            }
                                                        }, error: function (data) {
                                                            // console.log(data);
                                                        }
                                                    });
                                                } else {
                                                    alert('You can compare only 3 products')
                                                    $(`[data-id="l${productId}"]`).removeClass('selected_libra')
                                                }

                                            } else {
                                                showModal(productId, productSlug, productName);
                                            }
                                        } else {
                                            localStorage.setItem('compare_product', JSON.stringify({ [categoryId]: `${productId},` }));
                                            showModal(productId, productSlug, productName);
                                        }
                                        calculateCompareProductsCount();
                                    }

                                    function calculateCompareProductsCount() {
                                        let compareProducts = 0;
                                        const data = localStorage.getItem('compare_product');
                                        const categoryElements = JSON.parse(data);
                                        elementKeys = Object.keys(categoryElements);
                                        for (const elementKey in elementKeys) {
                                            const element = categoryElements[elementKeys[elementKey]].split(',');
                                            element[element.length - 1] === '' ? element.splice(-1, 1) : element;
                                            compareProducts += element.length;
                                        }
                                        $('#top-compare-total').html(compareProducts);
                                    }
                                </script>
                            }

                        </div>
                        @await Html.PartialAsync("_navbrend")
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

